let MenuItem;_815‍.x([["createMenuItem",()=>createMenuItem],["newItem",()=>newItem],["updateItem",()=>updateItem],["show",()=>show],["show_all",()=>show_all],["show_deals",()=>show_deals]]);_815‍.w("../models/menu_item",[["default",["MenuItem"],function(v){MenuItem=v}]]);

       const createMenuItem= async(req, res)=>{
    const {title} = req.body;
    let itemExists = await MenuItem.findOne({title: title}).exec();
    if(itemExists){
     return res.status(400).send("Item already exists");
    }
    else{
        newItem(req.body);
    }

}
       const newItem = async (data)=>{
    const {title} = data;
    let itemExists = await MenuItem.findOne({title: title}).exec();
    if(itemExists){
        console.log("already exists")
    }
    else{
        const newItem = new MenuItem(data);
    
        try{
            await newItem.save();
            _815‍.g.console.log("ITEM CREATED SUCCESSFULLY ===>", newItem.title)
        }
        catch(err){
            _815‍.g.console.log(`error creating item`, err)
        }
    }

    
}
       const updateItem=async (req, res)=>{
    _815‍.g.console.log(req.body);
    const query = {_id: req.params.id}
    const newValues = { $set: req.body }
    await MenuItem.updateOne(query, newValues, function(err,r){
        if(err){
            _815‍.g.console.log("error", err)
        } 
        console.log(`one item updated sucessfully.`) //if no error
        
    });
    console.log("yay")
}



       const show = async(req, res)=>{
    const item = await MenuItem.find({_id: req.params.id})
    _815‍.g.console.log(item)
    res.status(200).send(item[0])
}

       const show_all = async (req, res)=>{
    const items = await MenuItem.find()
    res.status(200).send(items)
    
}

       const show_deals=async (req,res)=>{
    const items = await MenuItem.find({food_type: "meal_deal"})
    res.status(200).send(items)
}



